/*! quiz 30-06-2016 */
function addListeners(){$("#nextBt, #nextQBt").click(function(){nextPage(currentPage+1),"block"==$("#response").css("display")&&($("#response").fadeOut("fast","swing"),$("#noClick").css("display","none"))}),$("#submitBt").click(function(){checkAnswer(),$(this).hide()}),$("#reviewBt").click(function(){reviewQuiz()}),$("#redoBt").click(function(){location.reload()}),$(".choice").click(function(){$(this).hasClass("selected")?($(this).removeClass("selected"),$("#submitBt").hide()):($("#submitBt").fadeIn(),$(this).parent().children(".choice").each(function(){$(this).removeClass("selected")}),$(this).addClass("selected"))}),$("#questionListBt").click(function(){"none"==$("#questionList").css("display")?($("#questionList").slideDown("fast","swing"),$("#noClick").css({display:"block",height:window.innerHeight+"px",width:window.innerWidth+"px"}),$("#questionListBt img").attr("src","img/icon-contract.gif")):($("#questionList").slideUp("fast","swing"),$("#noClick").css("display","none"),$("#questionListBt img").attr("src","img/icon-expand.gif"))}),$("#questionList p").click(function(){var a=$(this).parent().children().index(this);changePage(a+2),$("#response").css("display","none"),$("#noClick").css("display","none"),$("#reviewBt").css("display","none")}),$(window).resize(function(){canvas_resize()})}function run(){$("#splash").css("display","block"),vertical_center(),bg_resize(),$("#header").fadeIn("slow","swing"),$("#footer").fadeIn("slow","swing")}function nextPage(a){var b=a-2;if(0==answered[b]||qu.done);else if(1==answered[b]||a==totalPages){var c,d=answered.length;b>=d-1&&(b=0);for(var e=0;d>e;e++)if(0==answered[e]){c=e+2;break}void 0==c&&0==qu.done&&(qu.done=!0,c=totalPages),a=c}changePage(a)}function changePage(a){a!=currentPage&&($("#pageNum").html(a+" / "+totalPages),$("#canvas .page:nth-child("+currentPage+")").hide(),$("#canvas .page:nth-child("+a+")").fadeIn("slow","swing"),$("#canvas").scrollTop(0,0),currentPage=a,a==totalPages?($("#submitBt").css("display","none"),$("#nextBt").css("display","none"),$("#reviewBt").fadeIn("slow","swing"),$("#redoBt").fadeIn("slow","swing"),$("#score").scrollTop(0)):answered[a-2]?($("#canvas .page:nth-child("+a+") a.choice").each(function(){$(this).unbind("click"),0==$(this).hasClass("locked")&&$(this).addClass("locked")}),$("#nextBt").css("display","block"),$("#submitBt").css("display","none")):$("#nextBt").css("display","none"))}function checkAnswer(){if($(".page:nth-child("+currentPage+") .selected").length>0){var a=currentPage-2;answered[a]=!0;var b,c,d="<p>"+quiz[a+3][1]+"</p>";$(".page:nth-child("+currentPage+") .choice").each(function(a){$(this).hasClass("selected")&&(c=a,b=$(this).html())}),qValue=quiz[a+3][c+2][1],1==qu.type||2==qu.type?1==qValue?(d="<h3>"+txt.correct+"</h3>"+d,$("#questionList .listing p:nth-child("+(a+1)+")").addClass("right")):(d="<h3>"+txt.wrong+"</h3>"+d,$("#questionList .listing p:nth-child("+(a+1)+")").addClass("wrong")):$("#questionList .listing p:nth-child("+(a+1)+")").addClass("pt"+qValue),score+=qValue,$("#score h2").html("Your score is "+score+"."),d.length<1?nextPage(currentPage+1):($("#noClick").css({display:"block",height:window.innerHeight+"px",width:window.innerWidth+"px"}),$("#response div").html(d),$("#response").fadeIn("fast","swing"))}else alert(txt.noSelection)}function reviewQuiz(){changePage(2),$("#reviewBt").fadeOut("slow","swing")}function OrphanFilter(a){var b=a.lastIndexOf(" ");return-1!=b&&(a=a.substring(0,b)+"&nbsp;"+a.substring(b+1)),a=a.replace("-","&#8209;")}function getUrlVars(){var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d});return a}var qu={width:window.innerWidth,height:window.innerHeight,type:void 0,url:"data/questions",done:!1,bgAspect:1.6065},quiz=new Array,qHtml="",answered=new Array,currentPage=1,totalPages,backgroundImage="friendship-bg.jpg",splashImage="",score=0;init_html=function(){console.log("init_html"),fonts_load(),canvas_resize(),qu.url="data/"+getUrlVars().quiz+".xml",xml_loadQuestions(qu.url)},fonts_load=function(){if(WebFontConfig={google:{families:["Open+Sans:400,700","Amatic SC"]}},function(a){var b=a.createElement("script"),c=a.scripts[0];b.src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js",c.parentNode.insertBefore(b,c)}(document),document.createStyleSheet)document.createStyleSheet("https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css");else{var a="@import url('https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css');",b=document.createElement("link");b.rel="stylesheet",b.href="data:text/css,"+escape(a),document.getElementsByTagName("head")[0].appendChild(b)}},init_jquery=function(){bg_resize(),vertical_center()},canvas_resize=function(){qu.height=window.innerHeight,qu.width=window.innerWidth,qu.aspect=qu.width/qu.height,qu.aspect>=qu.bgAspect?(qu.orientation="landscape",document.getElementById("canvas")["class"]=qu.orientation):(qu.orientation="portrait",document.getElementById("canvas")["class"]=qu.orientation),document.getElementById("canvas").style.height=qu.height+"px",bg_resize(),vertical_center()},vertical_center=function(){var a;$(".vCenter").each(function(){a=($("#canvas").outerHeight()-$(this).outerHeight())/2-35,$(this).css("margin-top",a+"px")})},bg_resize=function(){if("portrait"==qu.orientation){$(".bg").height(qu.height);var a=Math.floor(qu.height*qu.bgAspect);$(".bg").css({width:a+"px","margin-top":"","margin-left":(qu.width-a)/2+"px"})}else{$(".bg").width(qu.width);var b=Math.floor(qu.width/qu.bgAspect);$(".bg").css({"margin-left":"",height:b+"px","margin-top":(qu.height-b)/2+"px"})}},xml_loadQuestions=function(a){$.ajax({type:"GET",url:a,dataType:"xml",success:xml_parseQuestions})},xml_parseQuestions=function(a){var b=$(a).find("data"),c=OrphanFilter($(b).find("title").text());document.title=$(b).find("title").text()+" | Kids Help Phone";var d=OrphanFilter($(b).find("description").text()),e=$(b).find("scores").text();qu.type=$(b).find("quizType").text(),$(b).find("backgroundImage").text().length>1&&(backgroundImage=$(b).find("backgroundImage").text()),$(b).find("titleBackgroundImage").text().length>1&&(splashImage=$(b).find("titleBackgroundImage").text()),quiz=[c,d,e];var f=$(b).find("questions"),g=new Array,h=new Array;$(f).children().each(function(){var a=OrphanFilter($(this).find("text").text()),b=OrphanFilter($(this).find("response").text());g=[a,b],$(this).children().each(function(){"a"==this.nodeName&&(h.push(OrphanFilter($(this).text())),h.push(Number($(this).attr("value"))),g.push(h),h=[])}),quiz.push(g),g=[]}),build_quiz()},build_quiz=function(){build_splash(),build_questions(),build_scorePage(),build_ui(),build_bg(),$("#canvas").html(qHtml),addListeners(),run()},build_splash=function(){qHtml+="<div class='page' id='splash'>",qHtml+="<div class='vCenter'><h1>"+quiz[0]+"</h1>",qHtml+="<p>"+quiz[1]+"</p></div>";var a=quiz.length-3;qHtml+="<p>("+txt.questionNumber.replace("{{#}}",a)+")</p>",qHtml+="</div>"},build_questions=function(){totalPages=quiz.length-1;for(var a=quiz.length-3,b=0;a>b;b++){qHtml+="<div class='page'>",qHtml+="<p class='questionNum'>Q."+(b+1)+"</p>",qHtml+="<h2 class='question'>"+quiz[b+3][0]+"</h2>",answered.push(!1);for(var c=quiz[b+3].length-2,d=0;c>d;d++)qHtml+="<a class='choice button'> "+quiz[b+3][d+2][0]+"</a>";qHtml+="</div>"}},build_scorePage=function(){qHtml+="<div class='page' id='score'>",qHtml+=quiz[2],qHtml+="</div>"},build_ui=function(){qHtml+="<div id='footer'>",qHtml+="<a id='submitBt' class='button'>"+txt.button.submit+"</a>",qHtml+="<a id='nextBt' class='button' >"+txt.button.next+" &nbsp;<i class='fa fa-arrow-right' aria-hidden='true'></i></a>",qHtml+="<a id='redoBt' class='button' >"+txt.button.restart+"</a>",qHtml+="</div>",qHtml+="<div id='noClick'></div>",qHtml+="<div id='response'><div></div>",qHtml+="<p><a id='nextQBt' class='button'>"+txt.button.nextQuestion+"</a></p>",qHtml+="</div>",qHtml+="<div id='header'>",qHtml+="<p id='title'>"+quiz[0]+"</p>",qHtml+="<p id='pageNum'>"+String(currentPage)+" / "+totalPages+"</p>",qHtml+="</div>"},build_bg=function(){qHtml+="<img class='bg' src='./img/backgrounds/"+backgroundImage+"'>",$("#canvas").css("background","url(./img/backgrounds/"+backgroundImage+") center top repeat")},$(document).ready(function(){}),window.onload=function(){init_html()};